{% extends 'passwords/base.html' %} {% block content %}
<h2>{{ password.site_name }}</h2>
<p>URL: {{ password.site_url }}</p>
<p>Username: {{ password.username }}</p>
<p>Password: <span id="password-mask">••••••••</span></p>

<form
  id="reveal-form"
  method="post"
  action="{% url 'passwords:password_reveal' password.id %}"
>
  {% csrf_token %}
  <input
    type="password"
    name="confirm_password"
    id="confirm_password"
    placeholder="Enter your account password"
    required
  />
  <button type="submit">Reveal</button>
</form>

<script>
  document
    .getElementById("reveal-form")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const resp = await fetch(form.action, {
        method: "POST",
        body: new FormData(form),
        credentials: "same-origin",
        headers: { "X-Requested-With": "XMLHttpRequest" }
      });
      if (!resp.ok) {
        alert("Re-authentication failed");
        return;
      }
      const data = await resp.json();
      document.getElementById("password-mask").textContent = data.password;
      form.remove();
    });
</script>
<a href="{% url 'passwords:dashboard' %}">Back to Dashboard</a>
{% endblock %}
